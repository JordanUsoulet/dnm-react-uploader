!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n(require("react"),require("prop-types")):"function"==typeof define&&define.amd?define(["react","prop-types"],n):(e=e||self).SmartCroppr=n(e.React,e.PropTypes)}(this,function(e,n){"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function r(){return(r=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e}).apply(this,arguments)}function i(e){return(i=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function a(e,n){return(a=Object.setPrototypeOf||function(e,n){return e.__proto__=n,e})(e,n)}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}e=e&&e.hasOwnProperty("default")?e.default:e,n=n&&n.hasOwnProperty("default")?n.default:n;var s={isURL:require("validator/isURL")},p=require("./svg/index.js"),c=require("./file-manager.js").default,u={camelCase:require("lodash/camelCase"),difference:require("lodash/difference"),get:require("lodash/get"),last:require("lodash/last"),upperFirst:require("lodash/upperFirst"),split:require("lodash/split")},d=function(n){function t(e){var n,o,r;return function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,(n=!(r=i(t).call(this,e))||"object"!=typeof r&&"function"!=typeof r?l(o):r).state={beingDropTarget:!1,height:null,file:null,loaded:!0,mounted:!1,url:"",width:null},n.change=n.change.bind(l(n)),n.handleChange=n.handleChange.bind(l(n)),n.handleClick=n.handleClick.bind(l(n)),n.handleCropClick=n.handleCropClick.bind(l(n)),n.handleDragLeave=n.handleDragLeave.bind(l(n)),n.handleDragOver=n.handleDragOver.bind(l(n)),n.handleDrop=n.handleDrop.bind(l(n)),n.handleInjectURLClick=n.handleInjectURLClick.bind(l(n)),n.handleLoad=n.handleLoad.bind(l(n)),n.handleRemoveClick=n.handleRemoveClick.bind(l(n)),n.handleURLChange=n.handleURLChange.bind(l(n)),n.get=n.get.bind(l(n)),n.injectURL=n.injectURL.bind(l(n)),n.change=n.change.bind(l(n)),n}var d,h,f;return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),n&&a(e,n)}(t,e.Component),d=t,(h=[{key:"componentDidMount",value:function(){this.setState({mounted:!0}),c.initializeDrag()}},{key:"change",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e){return null},t=this.props.maxSize;c.guessFileType(e)!==this.props.fileType?this.props.onInvalidFileExtensionError():t&&e.size>=t?this.props.onFileTooLargeError():this.props.onChange(e),n(e),this.refs.input.value=null}},{key:"handleChange",value:function(e){var n=u.get(e,"target.files.0");n&&this.change(n)}},{key:"handleClick",value:function(e){this.refs.input.click()}},{key:"handleCropClick",value:function(e){e.stopPropagation(),this.props.onCropClick()}},{key:"handleDragLeave",value:function(){this.setState({beingDropTarget:!1})}},{key:"handleDragOver",value:function(){this.setState({beingDropTarget:!0})}},{key:"handleDrop",value:function(e){e.preventDefault(),this.setState({beingDropTarget:!1});var n=u.get(e,"dataTransfer.files.0");n&&this.change(n)}},{key:"handleInjectURLClick",value:function(){this.injectURL(this.state.url,!0)}},{key:"handleLoad",value:function(){void 0===this.firstLoadDone&&(this.firstLoadDone=!0,this.props.onFirstLoad(),this.setState({loaded:!0}))}},{key:"handleRemoveClick",value:function(e){e.stopPropagation(),this.props.onRemoveClick()}},{key:"handleURLChange",value:function(e){var n=e.target.value;this.setState({url:n})}},{key:"get",value:function(e){return new Promise(function(n,t){var o=new XMLHttpRequest;o.responseType="blob",o.open("GET",e,!0),o.onload=function(){200===o.status?n(o.response):t(Error(o.statusText))},o.onerror=function(){return t(Error("Network Error"))},o.send()})}},{key:"injectURL",value:function(e){var n=this,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(e){return null};!t||s.isURL(e)?this.get(e).then(function(t){var r=u.last(u.split(e,"/")),i=new File([t],r,{type:t.type});n.change(i,o)}).catch(function(e){n.props.onURLInjectionError()}):this.props.onInvalidURLError()}},{key:"render",value:function(){var n=this,t=null,o=null,i=this.props.src&&(this.props.removable||this.props.croppable);if(this.props.src)switch(this.props.fileType||c.guessFileType(this.props.src)){case"image":if(this.state.loaded&&this.state.mounted&&this.props.imageCrop){var a=this.refs.zone.offsetWidth,l=this.refs.zone.offsetHeight,s=this.refs.img.offsetWidth,d=this.refs.img.offsetHeight,h=this.refs.img.naturalWidth,f=this.refs.img.naturalHeight,g=s*this.props.imageCrop.x/h,m=d*this.props.imageCrop.y/f,b=s*this.props.imageCrop.width/h,v=d*this.props.imageCrop.height/f,y=b/v,C=null;C="contain"===this.props.backgroundSize?l*y>a?a/b:l/v:l*y>a?l/v:a/b,t=e.createElement("img",{alt:"",ref:"img",src:this.props.src,onLoad:this.handleLoad,style:{position:"absolute",top:"50%",left:"50%",transformOrigin:"".concat(g+b/2,"px ").concat(m+v/2,"px"),transform:"\n                                        translateX(-".concat(g+b/2,"px)\n                                        translateY(-").concat(m+v/2,"px)\n                                        scale(").concat(C,")\n                                    "),clip:"rect(\n                                        ".concat(m,"px\n                                        ").concat(g+b,"px\n                                        ").concat(m+v,"px\n                                        ").concat(g,"px)\n                                    ")}})}else t=e.createElement("div",{style:{backgroundColor:this.props.backgroundColor,backgroundRepeat:"no-repeat",backgroundPosition:"center center",backgroundSize:this.props.backgroundSize,backgroundImage:"url(".concat(this.props.src,")"),position:"relative",width:"100%",height:"100%"}},e.createElement("img",{alt:"",ref:"img",src:this.props.src,onLoad:this.handleLoad,style:{position:"fixed",top:"-9999px",left:"-9999px"}}));break;case"video":t=e.createElement("video",{autoPlay:!0,loop:!0,muted:!0,src:this.props.src,onLoadedData:this.handleLoad,style:"cover"===this.props.backgroundSize?{height:"100%"}:{maxHeight:"100%",maxWidth:"100%"}})}switch(this.props.fileType){case"image":o=e.createElement(p.PhotoCamera,{className:"uploader-zone-fog-img"});break;case"video":o=e.createElement(p.VideoCamera,{className:"uploader-zone-fog-img"})}return e.createElement("div",r({"data-attr":"root"},u.get(this.props.customAttributes,"root",{}),{className:"\n                    uploader\n                    ".concat(u.get(this.props.customAttributes,"root.className",""),"\n                    ").concat(this.props.fetching?"uploader/fetching":"","\n                    ").concat(this.props.withURLInput?"uploader/withUrl":"","\n                    ").concat(i?"uploader/withControls":"","\n                ")}),e.createElement("input",{"data-attr":"input",ref:"input",type:"file",className:"uploader-input",onChange:this.handleChange}),e.createElement("div",{ref:"zone",className:"\n                        uploader-zone\n                        ".concat(this.props.withURLInput?"uploader-zone/withUrl":"","\n                    "),onDragOver:this.handleDragOver,onDragLeave:this.handleDragLeave,onDrop:this.handleDrop},t,e.createElement("div",{className:"uploader-zone-fog",onClick:this.handleClick},this.state.beingDropTarget?e.createElement(p.CloudComputing,{className:"uploader-zone-fog-img"}):o,e.createElement("div",{className:"uploader-zone-fog-caption"},this.props.fetching?this.props.catalogue.loading:this.props.catalogue.callToAction),!0===i&&e.createElement(e.Fragment,null,e.createElement("span",{className:"uploader-zone-fog-or"},"––––– ",this.props.catalogue.or," –––––"),e.createElement("div",{className:"uploader-zone-fog-controls"},!0===this.props.croppable&&e.createElement("span",{className:"uploader-zone-fog-controls-control",onClick:this.handleCropClick},this.props.cropIcon||e.createElement(p.Crop,null)),!0===this.props.removable&&e.createElement("span",{className:"uploader-zone-fog-controls-control",onClick:this.handleRemoveClick},this.props.removeIcon||e.createElement(p.Garbage,null)))))),!0===this.props.withURLInput&&e.createElement("div",{className:"uploader-url"},e.createElement("input",{className:"uploader-url-input",name:"url",value:this.state.url,placeholder:this.props.catalogue.urlInputPlaceholder,type:"text",onChange:this.handleURLChange,onKeyPress:function(e){13===e.which&&(e.preventDefault(),n.handleInjectURLClick())}}),e.createElement("span",{className:"uploader-url-addon",onClick:this.handleInjectURLClick},e.createElement(p.InternetGlobe,{className:"uploader-url-addon-icon"}),this.props.catalogue.urlSubmitText)))}}])&&o(d.prototype,h),f&&o(d,f),t}();d.propTypes={backgroundColor:n.string,backgroundSize:n.oneOf(["contain","cover"]),catalogue:function(e,n,o){var r=e[n],i=Object.keys(e[n]),a=Object.keys(d.defaultProps[n]);if(!r||"object"!==t(r))throw new Error("Catalogue must be an object.");var l=u.difference(a,i);if(l.length)throw new Error("Given catalogue is insufficient. Missing keys: "+JSON.stringify(l))},croppable:n.bool,customAttributes:n.object,fetching:n.bool,fileType:n.oneOf(["image","video"]),imageCrop:n.object,maxSize:n.number,onChange:n.func,onCropClick:n.func,onFileTooLargeError:n.func,onFirstLoad:n.func,onInvalidFileExtensionError:n.func,onInvalidURLError:n.func,onRemoveClick:n.func,onURLInjectionError:n.func,removable:n.bool,src:n.string,withURLInput:n.bool},d.defaultProps={backgroundColor:"transparent",backgroundSize:"cover",catalogue:{callToAction:null,loading:null,or:null,urlInputPlaceholder:null,urlSubmitText:null},croppable:!1,cropIcon:null,customAttributes:{},fetching:!1,fileType:"image",imageCrop:null,maxSize:1e7,onChange:function(e){return null},onCropClick:function(){return null},onFileTooLargeError:function(){return null},onFirstLoad:function(){return null},onInvalidFileExtensionError:function(){return null},onInvalidURLError:function(){return null},onRemoveClick:function(){return null},onURLInjectionError:function(){return null},removable:!1,removeIcon:null,src:null,withURLInput:!1};return function(e,n){void 0===n&&(n={});var t=n.insertAt;if(e&&"undefined"!=typeof document){var o=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css","top"===t&&o.firstChild?o.insertBefore(r,o.firstChild):o.appendChild(r),r.styleSheet?r.styleSheet.cssText=e:r.appendChild(document.createTextNode(e))}}("@keyframes app_uploader_fog_camera_pulse {\n    from {\n        transform: scale(0.7);\n    }\n    50% {\n        transform: scale(1);\n    }\n    to {\n        transform: scale(0.7);\n    }\n}\n.uploader {\n    position: relative;\n}\n.uploader\\/fetching .uploader-zone-fog-img {\n    animation: app_uploader_fog_camera_pulse 2s linear infinite;\n}\n.uploader\\/withUrl .uploader-zone {\n    border-top-left-radius: 0.25rem !important;\n    border-top-right-radius: 0.25rem !important;\n    border-bottom-left-radius: 0 !important;\n    border-bottom-right-radius: 0 !important;\n}\n.uploader\\/withControls .uploader-zone-fog-caption {\n    margin-top: 0;\n    bottom: 0;\n}\n.uploader\\/withControls .uploader-zone-fog-img {\n    width: 2.6rem;\n    top: 0.3rem;\n}\n.uploader\\/withControls .uploader-zone-fog-controls {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    flex-flow: row wrap;\n    position: relative;\n    bottom: 0.3rem;\n}\n.uploader\\/withControls .uploader-zone-fog-or {\n    font-size: 80%;\n}\n.uploader\\/withControls .uploader-zone-fog-controls > * {\n    margin: 0 0.3rem;\n}\n.uploader\\/withControls .uploader-zone-fog-controls-control {\n    height: 1.6rem;\n    width: 1.6rem;\n    fill: white;\n}\n.uploader img {\n    max-height: 100%;\n    max-width: 100%;\n    height: auto;\n    width: auto;\n}\n.uploader-url-addon {\n    display: flex;\n    align-items: center;\n    padding: .375rem .75rem;\n    margin-bottom: 0;\n    font-weight: 400;\n    line-height: 1.5;\n    color: #495057;\n    text-align: center;\n    white-space: nowrap;\n    background-color: #e9ecef;\n    border: 1px solid #ced4da;\n    border-left-width: 0;\n    border-top-right-radius: 0;\n    border-top-left-radius: 0;\n    border-bottom-left-radius: 0;\n    border-bottom-right-radius: .25rem;\n}\n.uploader-url-addon svg {\n    margin-right: 0.6rem;\n    fill: #495057;\n    height: 1.4rem;\n}\n.uploader-url-input {\n    display: block;\n    height: calc(1.5em + .75rem + 2px);\n    padding: .375rem .75rem;\n    font-weight: 400;\n    font-size: 1rem;\n    line-height: 1.5;\n    color: #495057;\n    background-color: #fff;\n    background-clip: padding-box;\n    border: 1px solid #ced4da;\n    border-radius: .25rem;\n    border-top-left-radius: 0;\n    border-top-right-radius: 0;\n    border-bottom-right-radius: 0;\n    position: relative;\n    flex-grow: 1;\n    margin-bottom: 0;\n}\n.uploader-url-input:focus {\n    outline: none;\n}\n.uploader-url {\n    width: 100%;\n    display: flex;\n    justify-content: center;\n    align-items: stretch;\n    flex-flow: row;\n    cursor: pointer;\n}\n.uploader-zone {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    flex-flow: row wrap;\n    width: 100%;\n    height: 14rem;\n    overflow: hidden;\n    position: relative;\n    border-radius: 500rem;\n    color: white;\n}\n.uploader-zone-fog {\n    display: flex;\n    justify-content: space-evenly;\n    align-items: center;\n    flex-flow: column;\n    background: rgba(0, 0, 0, 0.2);\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    cursor: pointer;\n}\n.uploader-zone-fog:hover {\n    background: rgba(0, 0, 0, 0.5);\n}\n.uploader-zone-fog-caption {\n    width: 80%;\n    text-align: center;\n    position: relative;\n    bottom: 1rem;\n    margin-top: 1rem;\n    text-shadow: 0 0 0.5rem black;\n}\n.uploader-zone-fog-img {\n    width: 5rem;\n    fill: white;\n    position: relative;\n    top: 1rem;\n}\n.uploader-input {\n    position: fixed;\n    top: -9999px;\n    left: -9999px;\n}"),d});
